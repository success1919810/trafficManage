import { router } from '@kit.ArkUI';

interface DutyRecord {
  id: string;
  name: string;
  department: string;
  dutyPoint: string;
  dutyDate: string;
  shiftTime: string;
  status: 'pending' | 'approved';
}

@Entry
@Component
struct DutyRecordApproval {
  @State currentMonth: number = 6;
  @State selectedDepartment: string = 'é€‰æ‹©éƒ¨é—¨';
  @State currentTab: number = 0; // 0-å¾…å®¡æ ¸, 1-å·²å®¡æ ¸
  @State searchText: string = '';
  @State text1: string = "æœˆä»½";
  @State text2: string = "é€‰æ‹©éƒ¨é—¨";
  @State index: number = 2;
  @State space: number = 8;
  @State arrowPosition: ArrowPosition = ArrowPosition.END;

  @State dutyRecords: DutyRecord[] = [
    {
      id: '1',
      name: 'å¼ ä¸‰ä¸‰',
      department: 'XXå¸‚äº¤è­¦æ”¯é˜Ÿä¸€å¤§é˜Ÿ',
      dutyPoint: 'å·¡åŒºä¸€åŒº',
      dutyDate: '2020-4-41',
      shiftTime: '8:30:00-12:00:00',
      status: 'pending'
    },
    {
      id: '2',
      name: 'å¼ ä¸‰ä¸‰',
      department: 'XXå¸‚äº¤è­¦æ”¯é˜Ÿä¸€å¤§é˜Ÿ',
      dutyPoint: 'å·¡åŒºä¸€åŒº',
      dutyDate: '2020-4-41',
      shiftTime: '8:30:00-12:00:00',
      status: 'pending'
    },
    {
      id: '3',
      name: 'å¼ ä¸‰ä¸‰',
      department: 'XXå¸‚äº¤è­¦æ”¯é˜Ÿä¸€å¤§é˜Ÿ',
      dutyPoint: 'å·¡åŒºä¸€åŒº',
      dutyDate: '2020-4-41',
      shiftTime: '8:30:00-12:00:00',
      status: 'pending'
    },
    {
      id: '4',
      name: 'æå››å››',
      department: 'XXå¸‚äº¤è­¦æ”¯é˜ŸäºŒå¤§é˜Ÿ',
      dutyPoint: 'å·¡åŒºäºŒåŒº',
      dutyDate: '2020-4-40',
      shiftTime: '14:00:00-18:00:00',
      status: 'approved'
    }
  ];

  private swiperController: SwiperController = new SwiperController();

  build() {
    Column() {
      // æ ‡é¢˜æ  - ä½¿ç”¨æ‚¨æä¾›çš„æ¨¡æ¿
      Row(){
        Text('<')
          .fontSize(40)
          .margin({bottom:30})
          .width('10%')
          .onClick(() => {
            router.back();
          })

        Text('å€¼ç­è®°å½•å®¡æ‰¹')
          .fontSize(20)
          .margin({ bottom: 0 })
          .textAlign(TextAlign.Center)
          .width('80%')

        Text('<')
          .fontSize(26)
          .fontColor('#F2F2F2')
          .margin({bottom:20})
          .width('10%')
      }.backgroundColor('#F2F2F2').width('100%').height(50).margin({ top: 40 });

      Row().height(2).backgroundColor('#F2F2F2').width('100%')

      // ç­›é€‰å™¨åŒºåŸŸ
      Row() {
        // æœˆä»½é€‰æ‹©
        Row() {
          Select([{ value: 'ä¸€æœˆ' }, { value: 'äºŒæœˆ' },{ value: 'ä¸‰æœˆ' },{ value: 'å››æœˆ' },{ value: 'äº”æœˆ' },{ value: 'å…­æœˆ' },{ value: 'ä¸ƒæœˆ' },{ value: 'å…«æœˆ' },{ value: 'ä¹æœˆ' },{ value: 'åæœˆ' },{ value: 'åä¸€æœˆ' },{ value: 'åäºŒæœˆ' }])
            .selected(this.index)
            .value(this.text1)
            .font({ size: 16, weight: 500 })
            .fontColor('#182431')
            .selectedOptionFont({ size: 16, weight: 400 })
            .optionFont({ size: 16, weight: 400 })
            .space(this.space)
            .arrowPosition(this.arrowPosition)
            .menuAlign(MenuAlignType.START, { dx: 0, dy: 0 })
            .optionWidth(120)
            .optionHeight(300)
            .onSelect((index: number, text?: string | undefined) => {
              console.info('Select:' + index);
              this.index = index;
              if (text) {
                this.text1 = text;
              }
            })
        }
        // éƒ¨é—¨é€‰æ‹©
        Row() {
          Select([{ value: 'å†…æ±Ÿå¸‚äº¤è­¦æ”¯é˜Ÿä¸€å¤§é˜Ÿ' }, { value: 'å†…æ±Ÿå¸‚äº¤è­¦æ”¯é˜ŸäºŒå¤§é˜Ÿ' },{ value: 'å†…æ±Ÿå¸‚äº¤è­¦æ”¯é˜Ÿä¸‰å¤§é˜Ÿ' },{ value: 'å†…æ±Ÿå¸‚äº¤è­¦æ”¯é˜Ÿå››å¤§é˜Ÿ' }])
            .selected(this.index)
            .value(this.text2)
            .font({ size: 16, weight: 500 })
            .fontColor('#182431')
            .selectedOptionFont({ size: 16, weight: 400 })
            .optionFont({ size: 16, weight: 400 })
            .space(this.space)
            .arrowPosition(this.arrowPosition)
            .menuAlign(MenuAlignType.START, { dx: 0, dy: 0 })
            .optionWidth(120)
            .optionHeight(300)
            .onSelect((index: number, text?: string | undefined) => {
              console.info('Select:' + index);
              this.index = index;
              if (text) {
                this.text2 = text;
              }
            })
        }

        Blank()

        // æœç´¢æ¡†
        Row() {
          Text('ğŸ”')
            .fontSize(16)
            .fontColor('#999999')
            .margin({ right: 8 })

          Text('è¾“å…¥äººå‘˜å§“åè¿›è¡Œæœç´¢')
            .fontSize(14)
            .fontColor('#CCCCCC')
        }
        .padding({ left: 12, right: 12, top: 8, bottom: 8 })
        .backgroundColor('#FFFFFF')
        .borderRadius(4)
        .width(180)
      }
      .width('100%')
      .padding({ left: 16, right: 16, top: 16, bottom: 16 })
      .backgroundColor('#F5F5F5')

      // çŠ¶æ€æ ‡ç­¾
      Row() {
        Text('å¾…å®¡æ ¸')
          .fontSize(16)
          .fontColor(this.currentTab === 0 ? '#007AFF' : '#999999')
          .fontWeight(this.currentTab === 0 ? FontWeight.Medium : FontWeight.Normal)
          .onClick(() => {
            this.currentTab = 0;
            this.swiperController.changeIndex(0);
          })

        Blank()

        Text('å·²å®¡æ ¸')
          .fontSize(16)
          .fontColor(this.currentTab === 1 ? '#007AFF' : '#999999')
          .fontWeight(this.currentTab === 1 ? FontWeight.Medium : FontWeight.Normal)
          .onClick(() => {
            this.currentTab = 1;
            this.swiperController.changeIndex(1);
          })
      }
      .width('100%')
      .padding({ left: 16, right: 16, bottom: 16 })
      .backgroundColor('#F5F5F5')

      // Swiperå†…å®¹åŒºåŸŸ
      Swiper(this.swiperController) {
        // å¾…å®¡æ ¸åˆ—è¡¨
        this.buildRecordList('pending')

        // å·²å®¡æ ¸åˆ—è¡¨
        this.buildRecordList('approved')
      }
      .width('100%')
      .layoutWeight(1)
      .onChange((index: number) => {
        this.currentTab = index;
      })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }

  @Builder
  buildRecordList(status: string) {
    List() {
      ForEach(this.dutyRecords.filter(record =>
      status === 'pending' ? record.status === 'pending' : record.status === 'approved'
      ), (record: DutyRecord) => {
        ListItem() {
          this.buildRecordCard(record)
        }
        .margin({ bottom: 12 })
      })
    }
    .width('100%')
    .padding({ left: 16, right: 16 })
  }

  @Builder
  buildRecordCard(record: DutyRecord) {
    Column() {
      // å¡ç‰‡å¤´éƒ¨ - å§“åå’ŒæŒ‰é’®
      Row() {
        Text(record.name)
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#007AFF')

        Blank()

        if (record.status === 'pending') {
          Button('å®¡æ ¸')
            .fontSize(14)
            .fontColor('#FFFFFF')
            .backgroundColor('#007AFF')
            .borderRadius(4)
            .padding({ left: 16, right: 16, top: 6, bottom: 6 })
            .onClick(() => {
              router.pushUrl({
                url: 'pages/ShenPiGuanLi/dutyRecordApproval'
              });
            })
        } else {
          Text('>')
            .fontSize(20)
            .fontColor('#CCCCCC')
            .onClick(() => {
              router.pushUrl({
                url: 'pages/ShenPiGuanLi/dutyRecordDetail'
              });
            })
        }
      }
      .width('100%')
      .margin({ bottom: 16 })

      // è¯¦ç»†ä¿¡æ¯
      Column({ space: 8 }) {
        Row() {
          Text('ç®¡ç†éƒ¨é—¨ï¼š')
            .fontSize(14)
            .fontColor('#333333')
            .width(80)

          Text(record.department)
            .fontSize(14)
            .fontColor('#666666')
            .layoutWeight(1)
        }
        .width('100%')
        .alignItems(VerticalAlign.Center)

        Row() {
          Text('æ‰§å‹¤ç‚¹ï¼š')
            .fontSize(14)
            .fontColor('#333333')
            .width(80)

          Text(record.dutyPoint)
            .fontSize(14)
            .fontColor('#666666')
            .layoutWeight(1)
        }
        .width('100%')
        .alignItems(VerticalAlign.Center)

        Row() {
          Text('å€¼ç­æ—¥æœŸï¼š')
            .fontSize(14)
            .fontColor('#333333')
            .width(80)

          Text(record.dutyDate)
            .fontSize(14)
            .fontColor('#666666')
            .layoutWeight(1)
        }
        .width('100%')
        .alignItems(VerticalAlign.Center)

        Row() {
          Text('ç­æ¬¡æ—¶æ®µï¼š')
            .fontSize(14)
            .fontColor('#333333')
            .width(80)

          Text(record.shiftTime)
            .fontSize(14)
            .fontColor('#666666')
            .layoutWeight(1)
        }
        .width('100%')
        .alignItems(VerticalAlign.Center)
      }
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#FFFFFF')
    .borderRadius(8)
    .shadow({ radius: 2, color: '#00000010', offsetY: 1 })
  }
}